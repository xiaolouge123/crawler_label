# Web Agent 数据收集插件 - 使用说明

## 📖 功能概述

这是一个 Chrome 浏览器扩展，可以帮助您：
- 智能选择网页元素内容
- 使用 OpenAI GPT 模型处理选中内容
- 导出完整的数据结构（包含原始HTML、清理后文本、AI结果等）
- 管理常用的 Prompt 预设

## 🚀 快速开始

### 1. 安装插件
1. 下载插件文件到本地
2. 打开 Chrome 浏览器，进入 `chrome://extensions/`
3. 开启"开发者模式"
4. 点击"加载已解压的扩展程序"，选择插件文件夹

### 2. 配置 API Key 和模型参数
1. 点击插件图标旁的设置按钮，或右键选择"选项"
2. 在设置页面配置以下参数：
   - **OpenAI API Key**: 输入您的 API Key
   - **模型名称**: 选择要使用的AI模型
   - **温度**: 调节输出的随机性（0-2）
   - **最大令牌数**: 设置响应的最大长度（100-32000）
3. 点击"保存设置"

**获取 OpenAI API Key:**
- 访问 [OpenAI Platform](https://platform.openai.com/api-keys)
- 登录您的账户
- 创建新的 API Key
- 复制并粘贴到插件设置中

**模型选择说明:**
- **gpt-4.1-mini**: 快速响应，适合日常任务
- **gpt-4.1**: 高质量输出，适合复杂任务
- **gpt-4.1-nano**: 轻量级模型，成本较低
- **deepseek-v3-250324**: 专业代码分析模型
- **doubao-pro-256k-241115**: 长文本处理模型
- **gemini-2.5-flash**: 快速多模态模型

### 3. 创建预设 Prompt（可选）
1. 在设置页面的"预设 Prompt 管理"部分
2. 输入预设名称（如"文章总结"、"代码解释"等）
3. 输入 Prompt 内容，使用 `{selection}` 作为选中内容的占位符
4. 点击"添加预设"

**预设示例:**
```
请帮我总结以下内容的要点：

{selection}

请用简洁的语言列出3-5个关键点。
```

## 🎯 使用流程

### 步骤 1: 选择内容
1. 在任意网页上点击插件图标
2. 页面进入选择模式（元素会显示红色虚线边框）
3. 点击您想要提取的网页元素
4. 插件会自动提取该元素的内容

### 步骤 2: 处理内容
1. 选择内容后会自动弹出处理窗口
2. 您可以：
   - 选择预设的 Prompt（点击预设按钮）
   - 或者在文本框中输入自定义 Prompt
   - 在"特殊要求"中添加额外说明（可选）
3. 点击"生成"按钮开始 AI 处理

### 步骤 3: 获取结果
AI 处理完成后，您可以：
- **📋 复制结果**: 将 AI 生成的文本复制到剪贴板
- **📁 导出 JSON**: 导出包含完整数据的 JSON 文件
- **🔄 重新生成**: 使用相同设置重新生成结果

## 📁 导出数据结构

导出的 JSON 文件包含以下信息：

```json
{
  "metadata": {
    "exportTime": "导出时间",
    "pluginVersion": "1.0",
    "userAgent": "浏览器信息"
  },
  "pageInfo": {
    "url": "页面URL",
    "title": "页面标题",
    "domain": "域名",
    "fullPageHtml": "完整页面HTML",
    "screenshot": "页面截图(base64)"
  },
  "selection": {
    "rawHtml": "选中元素的原始HTML",
    "cleanedText": "清理后的纯文本",
    "elementTag": "元素标签名",
    "textLength": "文本长度"
  },
  "prompt": {
    "selectedPreset": "选择的预设名称",
    "customPrompt": "自定义Prompt",
    "specialRequirements": "特殊要求",
    "fullPrompt": "发送给AI的完整Prompt"
  },
  "aiResponse": {
    "result": "AI生成的结果",
    "success": true,
    "resultLength": "结果长度",
         "requestParameters": {
       "model": "用户选择的模型名称",
       "maxTokens": "用户设置的最大令牌数",
       "temperature": "用户设置的温度值",
       "apiProvider": "OpenAI"
     },
    "processingTime": "处理时间"
  },
  "statistics": {
    "totalProcessingTime": "总处理时间",
    "htmlSize": "HTML大小",
    "cleanedTextSize": "清理后文本大小",
    "promptSize": "Prompt大小",
    "responseSize": "响应大小"
  }
}
```

## ⚙️ 高级功能

### 内容清理
插件会自动清理选中的HTML内容：
- 移除JavaScript代码和样式
- 保留文本内容和链接
- 转换图片为描述文本
- 保持表格结构
- 移除多余的空白字符

### 超时处理
- 根据内容长度动态设置超时时间
- 长内容会有更长的处理时间
- 网络错误时提供详细的错误信息

### 参数调优建议
- **创意任务**: 使用较高温度（1.0-1.5）和较大令牌数
- **分析任务**: 使用较低温度（0.1-0.5）确保准确性
- **代码相关**: 推荐使用 deepseek-v3-250324 模型
- **长文本**: 推荐使用 doubao-pro-256k-241115 模型

### 快捷键
- **设置页面**: Ctrl + Enter 保存设置
- **预设管理**: Ctrl + Enter 添加预设
- **Enter键**: 在输入框间快速切换
- **温度滑块**: 实时显示数值变化

## 🔧 故障排除

### API 调用失败
1. 检查 API Key 是否正确配置
2. 确认 API Key 有足够的配额
3. 检查网络连接
4. 查看是否需要科学上网

### 内容选择问题
1. 确保页面完全加载
2. 尝试刷新页面后重新选择
3. 避免选择动态加载的内容

### 导出功能问题
1. 确保浏览器允许下载文件
2. 检查下载文件夹权限
3. 尝试手动复制结果

## 📞 技术支持

如果遇到问题，请检查：
1. Chrome 开发者工具的控制台错误信息
2. 插件的后台页面日志
3. API 服务的状态

---

**注意**: 请妥善保管您的 API Key，不要在公共场所或不安全的环境中使用。 